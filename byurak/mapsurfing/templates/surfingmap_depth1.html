{% extends 'base.html' %}
{% load static %}

<head>

</head>
{% block contents %}
<form class="searchform group" action="{% url 'depth2' %}" method="get"
    style="width:80%; padding: 0 0 0 0; margin:30px 10% 30px 10%">
    <label for="search-box">
        <span class="fa fa-2x fa-search"></span>
    </label>
    <input type="search" class="fa fa-2x fa-search" style placeholder="가고싶은 지역 또는 하고싶은 체험활동을 입력해주세요.">

</form>
<div class="row">
    <div class="col-5">
        <hr>
        <div class="card">
            <div class="row">
                <div class="col-5" style="margin:0px">
                    <img src="{% static 'image/profilePicture.jpg' %}" alt="Person" class="card__image">
                </div>
                <div class="col-7">
                    <p class="card__name">안산 양궁 체험장</p>
                    <div class="grid-container">
                        Review : 156
                    </div>
                    <button class="btn draw-border">보러 가기</button>
                </div>
            </div>

        </div>
    </div>
    <div class="col-7">
        <div id="map" style="width:100%; height: 450px; margin: auto"></div>

    </div>
</div>

<!-- {% for profile in profiles %}
{{profile.address}}
{% endfor %} -->

<script type="text/javascript"
    src="//dapi.kakao.com/v2/maps/sdk.js?appkey={{KAKAO_MAP_KEY}}&libraries=clusterer,services"></script>
<script>
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
        mapOption = {
            center: new kakao.maps.LatLng(36.31765817178337, 127.96235165282474), // 지도의 중심좌표
            level: 13 // 지도의 확대 레벨
        };
    var map = new kakao.maps.Map(mapContainer, mapOption);
    // 마커 클러스터러를 생성합니다 
    var clusterer = new kakao.maps.MarkerClusterer({
        map: map, // 마커들을 클러스터로 관리하고 표시할 지도 객체 
        averageCenter: true, // 클러스터에 포함된 마커들의 평균 위치를 클러스터 마커 위치로 설정 
        minLevel: 8 // 클러스터 할 최소 지도 레벨 
    });
    var map_coordinate_data = [
        [37.50417693439669, 126.95669427974502, '<div style="padding:5px">중앙대학교</div>'],
        [37.49588032997288, 126.95693766986257, '<div style="padding:5px">숭실대학교</div>'],
        [37.45971000415799, 126.9492757952058, '<div style="padding:5px">서울대학교</div>'],
        [35.84648059644505, 127.12891076848453, '<div style="padding:5px">전북대학교</div>'],
        [35.889341095263866, 128.61030430454034, '<div style="padding:5px">경북대학교</div>']
    ]
    var markers = [];
    for (var i = 0; i < map_coordinate_data.length; i++) {
        // 마커가 표시될 위치입니다 
        var markerPosition = new kakao.maps.LatLng(map_coordinate_data[i][0], map_coordinate_data[i][1]);
        // 마커를 생성합니다
        var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png', // 마커이미지의 주소입니다    
            imageSize = new kakao.maps.Size(32, 34), // 마커이미지의 크기입니다
            imageOption = { offset: new kakao.maps.Point(27, 69) }; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.

        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
        var marker = new kakao.maps.Marker({
            position: markerPosition,
            image: markerImage
        });
        displayMarker(marker, map_coordinate_data);

    }



    function displayMarker(marker, map_coordinate_data) {
        // 마커가 지도 위에 표시되도록 설정합니다
        marker.setMap(map);
        var iwContent = '<div class="wrap">' +
            '    <div class="info">' +
            '        <div class="title">' +
            '            카카오 스페이스닷원' +
            '            <div class="close" title="닫기"></div>' +
            '        </div>' +
            '        <div class="body">' +
            '            <div class="img">' +
            '                <img src="https://cfile181.uf.daum.net/image/250649365602043421936D" width="73" height="70">' +
            '           </div>' +
            '            <div class="desc">' +
            '                <div class="ellipsis">제주특별자치도 제주시 첨단로 242</div>' +
            '                <div class="jibun ellipsis">(우) 63309 (지번) 영평동 2181</div>' +
            '                <div><a href="https://www.kakaocorp.com/main" target="_blank" class="link">홈페이지</a></div>' +
            '            </div>' +
            '        </div>' +
            '    </div>' +
            '</div>';
        // var iwContent = map_coordinate_data[i][2] // 인포윈도우에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다

        iwPosition = new kakao.maps.LatLng(map_coordinate_data[i][0], map_coordinate_data[i][1]);//인포윈도우 표시 위치입니다
        // 인포윈도우를 생성합니다

        var overlay = new kakao.maps.CustomOverlay({
            map: map,
            position: iwPosition,
            content: iwContent,
        });

        // 마커 위에 인포윈도우를 표시합니다. 두번째 파라미터인 marker를 넣어주지 않으면 지도 위에 표시됩니다
        markers.push(marker);
        // 마커에 mouseover 이벤트와 mouseout 이벤트를 등록합니다
        // 이벤트 리스너로는 클로저를 만들어 등록합니다 
        // for문에서 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록됩니다
        //kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, customOverlay));
        //kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(customOverlay));
        overlay.setMap(null)
        // var content = document.createElement('div');
        // content.style.cssText='backgroud-color:white; height:100px';
        
        var contentText = document.createElement('div')
        contentText.innerHTML = '<div class="wrap">' +
                '    <div class="info">' +
                '        <div class="title">' +
                            map_coordinate_data[i][2] +
                '        </div>' +
                '        <div class="body">' +
                '            <div class="img">' +
                '                <img src="'+'{% static 'image/profilePicture.jpg' %}'+'" height="70">' +
                '           </div>' +
                '            <div class="desc">' +
                '                <div class="ellipsis">제주특별자치도 제주시 첨단로 242</div>' +
                '                <div class="jibun ellipsis">(우) 63309 (지번) 영평동 2181</div>' +
                '                <div><a href="https://www.kakaocorp.com/main" target="_blank" class="link">홈페이지</a></div>' +
                '            </div>' +
                '        </div>' +
                '    </div>' +
                '</div>';
        
        // content.appendChild(contentText);
        var closeBtn = document.createElement('button');
        closeBtn.setAttribute("id", "mapBtn");
        closeBtn.innerHTML = 'x';
        closeBtn.onclick = function () {
            overlay.setMap(null);
        };
        contentText.appendChild(closeBtn);
        
        //document.body.getElementsByClassName('close').appendChild(closeBtn)
        
        // content.appendChild(test);
        overlay.setContent(contentText);
    
        kakao.maps.event.addListener(marker, 'click', function() {
            overlay.setMap(map);
        });

       
    }

    // 커스텀 오버레이를 닫기 위해 호출되는 함수입니다 

    // 클러스터러에 마커들을 추가합니다
    //clusterer.addMarkers(markers);
    // 인포윈도우를 표시하는 클로저를 만드는 함수입니다 

    // 지도 레벨을 표시합니다
    displayLevel();

    // 지도 레벨은 지도의 확대 수준을 의미합니다
    // 지도 레벨은 1부터 14레벨이 있으며 숫자가 작을수록 지도 확대 수준이 높습니다
    function zoomIn() {
        // 현재 지도의 레벨을 얻어옵니다
        var level = map.getLevel();

        // 지도를 1레벨 내립니다 (지도가 확대됩니다)
        map.setLevel(level - 1);

        // 지도 레벨을 표시합니다
        displayLevel();
    }
    function zoomOut() {
        // 현재 지도의 레벨을 얻어옵니다
        var level = map.getLevel();

        // 지도를 1레벨 올립니다 (지도가 축소됩니다)
        map.setLevel(level + 1);

        // 지도 레벨을 표시합니다
        displayLevel();
    }

</script>

{% endblock %}