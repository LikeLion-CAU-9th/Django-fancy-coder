{% extends 'base.html' %}

{% block contents %}

<form action = "{% url 'depth2' %}" method = "get">
    <input type = "search" value = "" id = "keyword" style = "width: 700px; height :30px; margin:30px 0 30px 310px;"> 
    <input type="submit">
</form>

<div id="map" style="width:1000px;height:750px; margin-left: 170px;"></div>


<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey={{KAKAO_MAP_KEY}}&libraries=clusterer"></script>
<script>
var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
    mapOption = { 
        center: new kakao.maps.LatLng(36.31765817178337, 127.96235165282474), // 지도의 중심좌표
        level: 12 // 지도의 확대 레벨
    };

var map = new kakao.maps.Map(mapContainer, mapOption);

 // 마커 클러스터러를 생성합니다 
 var clusterer = new kakao.maps.MarkerClusterer({
        map: map, // 마커들을 클러스터로 관리하고 표시할 지도 객체 
        averageCenter: true, // 클러스터에 포함된 마커들의 평균 위치를 클러스터 마커 위치로 설정 
        minLevel: 8 // 클러스터 할 최소 지도 레벨 
    });

var map_coordinate_data = [
    [37.50417693439669, 126.95669427974502, '<div style="padding:5px">중앙대학교</div>'],
    [37.49588032997288, 126.95693766986257, '<div style="padding:5px">숭실대학교</div>'],
    [37.45971000415799, 126.9492757952058, '<div style="padding:5px">서울대학교</div>'],
    [35.84648059644505, 127.12891076848453, '<div style="padding:5px">전북대학교</div>'],
    [35.889341095263866, 128.61030430454034, '<div style="padding:5px">경북대학교</div>']
]

var markers = [];

for(var i=0; i< map_coordinate_data.length; i++) {
    // 마커가 표시될 위치입니다 
var markerPosition  = new kakao.maps.LatLng(map_coordinate_data[i][0],map_coordinate_data[i][1]); 

// 마커를 생성합니다
var marker = new kakao.maps.Marker({
    position: markerPosition
});

// 마커가 지도 위에 표시되도록 설정합니다
marker.setMap(map);

var iwContent = map_coordinate_data[i][2] // 인포윈도우에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다
iwPosition = new kakao.maps.LatLng(map_coordinate_data[i][0],map_coordinate_data[i][1]);//인포윈도우 표시 위치입니다

// 인포윈도우를 생성합니다
var infowindow = new kakao.maps.InfoWindow({
    position : iwPosition, 
    content : iwContent 
});
  
// 마커 위에 인포윈도우를 표시합니다. 두번째 파라미터인 marker를 넣어주지 않으면 지도 위에 표시됩니다

markers.push(marker);
   // 마커에 mouseover 이벤트와 mouseout 이벤트를 등록합니다
    // 이벤트 리스너로는 클로저를 만들어 등록합니다 
    // for문에서 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록됩니다
    kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
    kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
}
     

 // 클러스터러에 마커들을 추가합니다
 clusterer.addMarkers(markers);

// 인포윈도우를 표시하는 클로저를 만드는 함수입니다 
function makeOverListener(map, marker, infowindow) {
    return function() {
        infowindow.open(map, marker);
    };
}

// 인포윈도우를 닫는 클로저를 만드는 함수입니다 
function makeOutListener(infowindow) {
    return function() {
        infowindow.close ();
    };
}
</script>

{% endblock %}

